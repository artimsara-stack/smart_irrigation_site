<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Smart Irrigation Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 10px;
    }

    h1 {
      text-align: center;
      margin-bottom: 15px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }

    .card {
      background: #1e293b;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
    }

    .value {
      font-size: 22px;
      font-weight: bold;
      margin-top: 5px;
    }

    canvas {
      background: #020617;
      border-radius: 10px;
      padding: 10px;
    }
  </style>
</head>

<body>

<h1>üå± Smart Irrigation</h1>

<div class="grid">
  <div class="card">Temp√©rature<br><div class="value" id="tAir">--</div></div>
  <div class="card">Humidit√© air<br><div class="value" id="rh">--</div></div>
  <div class="card">Humidit√© sol<br><div class="value" id="soil">--</div></div>
  <div class="card">Lumi√®re (Lux)<br><div class="value" id="lux">--</div></div>
  <div class="card">Vent (m/s)<br><div class="value" id="wind">--</div></div>
  <div class="card">Pression (hPa)<br><div class="value" id="press">--</div></div>
  <div class="card">VPD (kPa)<br><div class="value" id="vpd">--</div></div>
  <div class="card">EDI<br><div class="value" id="edi">--</div></div>
</div>

<canvas id="chart" height="120"></canvas>

<script>
/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
  databaseURL: "https://smart-irrigation-site-90e51-default-rtdb.firebaseio.com/"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const dataRef = db.ref("latest");

/* ================= CHART ================= */
const ctx = document.getElementById("chart").getContext("2d");
const chart = new Chart(ctx, {
  type: "line",
  data: {
    labels: [],
    datasets: [
      { label: "Temp (¬∞C)", data: [] },
      { label: "VPD (kPa)", data: [] },
      { label: "EDI", data: [] }
    ]
  },
  options: {
    responsive: true,
    scales: {
      y: { beginAtZero: false }
    }
  }
});

/* ================= REALTIME UPDATE ================= */
dataRef.on("value", snap => {
  const d = snap.val();
  if (!d) return;

  document.getElementById("tAir").innerText  = d.air_temp?.toFixed(1) ?? "--";
  document.getElementById("rh").innerText    = d.air_rh?.toFixed(1) ?? "--";
  document.getElementById("soil").innerText  = d.soil_pct?.toFixed(1) ?? "--";
  document.getElementById("lux").innerText   = d.lux ?? "--";
  document.getElementById("wind").innerText  = d.wind_ms?.toFixed(1) ?? "--";
  document.getElementById("press").innerText = d.pressure_hpa?.toFixed(1) ?? "--";
  document.getElementById("vpd").innerText   = d.vpd?.toFixed(2) ?? "--";
  document.getElementById("edi").innerText   = d.edi?.toFixed(2) ?? "--";

  const time = new Date().toLocaleTimeString();

  chart.data.labels.push(time);
  chart.data.datasets[0].data.push(d.air_temp);
  chart.data.datasets[1].data.push(d.vpd);
  chart.data.datasets[2].data.push(d.edi);

  if (chart.data.labels.length > 20) {
    chart.data.labels.shift();
    chart.data.datasets.forEach(ds => ds.data.shift());
  }

  chart.update();
});
</script>

</body>
</html>
